# AHC VDSL

このビジュアライザは、`vis/index.html` 単体で動作するWebベースのツールです。
実行時の出力から特定のプレフィックス（`$v`）を持つ行をパースし、アニメーションや盤面情報を描画します。

## 使い方

1. ヒューリスティックコンテストのプログラムを実行し、標準エラー出力を `err/{seed}.txt` に保存します。
   - 同時に `in/{seed}.txt`, `out/{seed}.txt` もあると入力・出力欄に表示されます。
2. `vis/index.html` をブラウザで開きます。 
   - ※ローカルサーバ経由で開くか、ブラウザのセキュリティ設定によってはローカルファイルの読み込みに制限がある場合があります。VS Codeの "Live Server" 拡張機能などを使うとスムーズです。
3. 画面上の "Seed" 入力欄にシード番号（例: 0）を入力すると、自動的に対応するファイルの読み込みと描画が行われます。

## プロトコル仕様

プログラムから以下のフォーマットで標準エラー出力に行を出力することで、ビジュアライザを制御できます。
全てのコマンドは `$v(MODE)` または `$v` で始まります。

- `MODE`: 任意の文字列（数字、アルファベット等）。これにより表示モードを切り替えることができます。
- `MODE` を省略して `$v` と書いた場合は、自動的に `default` モードとして扱われます。

例:
```text
$v(main) GRID ...
$v(sub) TEXTAREA ...
```

### 1. フレーム区切り: `$v(MODE) COMMIT`

現在のフレームの描画コマンドを確定し、次のフレームへ移行します。
これを出力するたびに、Web上のスライダーで操作できる「1ステップ」が記録されます。
モードごとに独立してフレームが進みます。

```text
$v(MODE) COMMIT
```

### 2. グリッド描画: `$v(MODE) GRID`

盤面（グリッド）を描画します。

**基本構文:**
```text
$v(MODE) GRID [H] [W] [BORDER_COLOR] [TEXT_COLOR] [DEFAULT_CELL_COLOR]
```
- `H`: 行数
- `W`: 列数
- `BORDER_COLOR`: グリッド線の色（例: `#000000`, `black`）
- `TEXT_COLOR`: 文字色
- `DEFAULT_CELL_COLOR`: デフォルトの背景色

この行の直後に、以下のセクションヘッダを使用して詳細データを記述します（ここは `$v` プレフィックス無し）。

#### A. セル背景色 (全指定): `CELL_COLORS`

全セルの色を行ごとに指定します。

```text
CELL_COLORS
#FFFFFF #FF0000 ... (W個の色)
#00FF00 #0000FF ...
... (H行分)
```

#### B. セル背景色 (部分指定): `CELL_COLORS_POS`

変化があったセルだけ色を指定したい場合に便利です。

```text
CELL_COLORS_POS
[グループ数N]
[色] [個数K] [r1] [c1] [r2] [c2] ... (K個の座標ペア)
... (N行分)
```

#### C. セル内テキスト: `CELL_TEXT`


セルの中に文字を表示します。

```text
CELL_TEXT
text1 "text with space" ... (W個)
... (H行分)
```

#### D. 線描画: `LINES`

グリッド上に線分を描画します。

```text
LINES
[線のグループ数N]
[色] [頂点数K] [x1] [y1] [x2] [y2] ... (K個の頂点座標)
... (N行分)
```
※ 座標は (x=列, y=行) です。

### 3. 情報パネル (テキストエリア): `$v(MODE) TEXTAREA`

画面右側の情報パネルに複数行のテキストエリアを追加します（長い情報向け）。

```text
$v(MODE) TEXTAREA DebugInfo: ...
```

### 5. スコア更新: `$v(MODE) SCORE`

画面上部の「Score = ...」の表示を更新します。

```text
$v(MODE) SCORE 12345
```

### 6. デバッグ表示: `$v(MODE) DEBUG`

このコマンドが含まれるフレームでは、そのフレームを構成するために出力された生のコマンド文字列を、ビジュアライザの右側に追加表示します。デバッグ用途に便利です。

```text
$v(MODE) DEBUG
```

---

## 実装例 (Rust)

```rust
// メインモードでグリッド初期化
eprintln!("$v(main) GRID 30 30 #ddd black white");

// サブモードで別の情報を表示
eprintln!("$v(debug) TEXTAREA Start Processing...");

// デバッグ表示を有効にする
eprintln!("$v(main) DEBUG");

// ... 処理 ...

// メインモードのフレーム更新
eprintln!("$v(main) SCORE {}", score);
eprintln!("$v(main) COMMIT");
```
